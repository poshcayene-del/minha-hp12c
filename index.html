<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>HP 12c Platinum - Versão Master Corrigida</title>
    <style>
        * { box-sizing: border-box; user-select: none; }
        body { background: #c0c0c0; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; font-family: 'Segoe UI', Arial, sans-serif; }
        
        .hp12c {
            background: #1a1a1a;
            width: 740px; 
            padding: 40px 25px 80px 25px; /* Padding inferior aumentado para o L.R. */
            border-radius: 12px; 
            box-shadow: 0 50px 100px rgba(0,0,0,0.7);
            border: 3px solid #000;
            position: relative;
        }

        .faceplate {
            background: linear-gradient(180deg, #e0e0e0 0%, #bbbbbb 100%);
            border-radius: 6px; padding: 20px; border: 1px solid #777;
        }

        .lcd-container {
            background: #000; padding: 5px; border-radius: 4px; width: 320px; margin-bottom: 40px;
        }
        .lcd { 
            background: #9ead94; height: 70px; padding: 10px; text-align: right;
            border: 2px solid #333; box-shadow: inset 0 0 15px rgba(0,0,0,0.2);
        }
        #display { font-size: 38px; font-family: 'Courier New', monospace; font-weight: bold; color: #1a1d18; }
        .indicators { font-size: 11px; color: #1a1d18; height: 12px; font-weight: bold; text-align: left; }

        .logo { position: absolute; top: 60px; right: 50px; text-align: right; }
        .logo h1 { margin: 0; font-size: 26px; font-style: italic; color: #222; }

        .keypad { 
            display: grid; grid-template-columns: repeat(10, 1fr); 
            grid-template-rows: repeat(4, 48px); gap: 42px 12px; margin-top: 20px;
        }

        .btn-cell { position: relative; width: 100%; height: 100%; }

        .btn { 
            width: 100%; height: 100%; border-radius: 4px; color: #fff; font-size: 13px; font-weight: bold;
            background: linear-gradient(180deg, #444 0%, #111 100%); 
            border: none; border-bottom: 4px solid #000; cursor: pointer; position: relative; z-index: 2;
        }
        .btn:active { transform: translateY(2px); border-bottom: 2px solid #000; }
        
        .btn-f { background: #d68a00 !important; color: #000 !important; border-bottom-color: #935f00 !important; }
        .btn-g { background: #0099cc !important; border-bottom-color: #006b8f !important; }
        .btn-enter { grid-column: 6; grid-row: 3 / 5; height: 100% !important; background: #555 !important; }

        .lbl-f { position: absolute; top: -18px; width: 100%; text-align: center; color: #d68a00; font-size: 10px; font-weight: bold; }
        .lbl-g { position: absolute; bottom: -20px; width: 100%; text-align: center; color: #0099cc; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="hp12c">
    <div class="faceplate">
        <div class="logo"><h1>hp 12c</h1><small>platinum</small></div>
        <div class="lcd-container">
            <div class="lcd">
                <div class="indicators"><span id="ind"></span></div>
                <div id="display">0,00</div>
            </div>
        </div>

        <div class="keypad">
            <div class="btn-cell"><span class="lbl-f">AMORT</span><button class="btn" onclick="pressTVM('n')">n</button><span class="lbl-g">12x</span></div>
            <div class="btn-cell"><span class="lbl-f">INT</span><button class="btn" onclick="pressTVM('i')">i</button><span class="lbl-g">12÷</span></div>
            <div class="btn-cell"><span class="lbl-f">NPV</span><button class="btn" onclick="pressTVM('pv')">PV</button><span class="lbl-g">CFo</span></div>
            <div class="btn-cell"><span class="lbl-f">IRR</span><button class="btn" onclick="pressTVM('pmt')">PMT</button><span class="lbl-g">CFj</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressTVM('fv')">FV</button><span class="lbl-g">Nj</span></div>
            <div class="btn-cell"><span class="lbl-f">DATE</span><button class="btn" onclick="pressOp('chs')">CHS</button><span class="lbl-g">BEG</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(7)">7</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(8)">8</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(9)">9</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('/')">÷</button></div>

            <div class="btn-cell"><button class="btn" onclick="pressOp('yx')">y<sup>x</sup></button><span class="lbl-g">√x</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('1x')">1/x</button><span class="lbl-g">e<sup>x</sup></span></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('%t')">%T</button><span class="lbl-g">LN</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('delta%')">Δ%</button><span class="lbl-g">FRAC</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('%')">%</button><span class="lbl-g">INTg</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('eex')">EEX</button><span class="lbl-g">ODD</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(4)">4</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(5)">5</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(6)">6</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('*')">×</button></div>

            <div class="btn-cell"><button class="btn">R/S</button></div>
            <div class="btn-cell"><button class="btn">SST</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('rol')">R↓</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('xy')">x<>y</button></div>
            <div class="btn-cell"><span class="lbl-f">REG</span><button class="btn" onclick="pressOp('clx')">CLX</button><span class="lbl-g">FIN</span></div>
            <button class="btn btn-enter" onclick="pressEnter()">ENTER</button>
            <div class="btn-cell"><button class="btn" onclick="pressNum(1)">1</button><span class="lbl-g">x̄</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(2)">2</button><span class="lbl-g">s</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum(3)">3</button><span class="lbl-g">n!</span></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('-')">-</button></div>

            <div class="btn-cell"><button class="btn" onclick="resetCalc()">ON</button></div>
            <div class="btn-cell"><button class="btn btn-f" onclick="setMode('f')">f</button></div>
            <div class="btn-cell"><button class="btn btn-g" onclick="setMode('g')">g</button></div>
            <div class="btn-cell"><button class="btn" onclick="setMode('sto')">STO</button></div>
            <div class="btn-cell"><button class="btn" onclick="setMode('rcl')">RCL</button></div>
            <div class="btn-cell" style="grid-column: 7;"><button class="btn" onclick="pressNum(0)">0</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressNum('.')">.</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('sigma')">Σ+</button></div>
            <div class="btn-cell"><button class="btn" onclick="pressOp('+')">+</button><span class="lbl-g">L.R.</span></div>
        </div>
    </div>
</div>

<script>
    let stack = [0, 0, 0, 0]; // X, Y, Z, T
    let tvm = { n:0, i:0, pv:0, pmt:0, fv:0 };
    let stats = { n:0, sumX:0, sumX2:0 };
    let buffer = ""; 
    let mode = null;
    let isTyping = false;

    const displayEl = document.getElementById('display');
    const indEl = document.getElementById('ind');

    function updateLCD() {
        if (isTyping) {
            displayEl.innerText = buffer.replace('.', ',');
        } else {
            displayEl.innerText = stack[0].toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        indEl.innerText = mode ? mode.toUpperCase() : "";
    }

    function pressNum(v) {
        if (mode === 'sto' || mode === 'rcl') return; 
        if (!isTyping) {
            buffer = v === '.' ? "0." : v.toString();
            isTyping = true;
        } else {
            if (v === '.' && buffer.includes('.')) return;
            buffer += v.toString();
        }
        stack[0] = parseFloat(buffer);
        updateLCD();
    }

    function pressEnter() {
        if (isTyping) { stack[0] = parseFloat(buffer); isTyping = false; }
        stack[3] = stack[2]; stack[2] = stack[1]; stack[1] = stack[0];
        updateLCD();
    }

    function pressOp(op) {
        if (isTyping) { stack[0] = parseFloat(buffer); isTyping = false; }
        
        if (mode === 'g') {
            if (op === 'yx') stack[0] = Math.sqrt(stack[0]);
            if (op === '1x') stack[0] = Math.exp(stack[0]);
            if (op === 'sigma') { /* sigma - logic */ }
            mode = null; updateLCD(); return;
        }

        let x = stack[0]; let y = stack[1];
        if (op === '+') { stack[0] = y + x; drop(); }
        if (op === '-') { stack[0] = y - x; drop(); }
        if (op === '*') { stack[0] = y * x; drop(); }
        if (op === '/') { stack[0] = y / x; drop(); }
        if (op === 'yx') { stack[0] = Math.pow(y, x); drop(); }
        if (op === '1x') { stack[0] = 1 / x; }
        if (op === 'chs') { stack[0] = -x; }
        if (op === 'clx') { stack[0] = 0; buffer = ""; }
        if (op === 'xy') { stack[1] = x; stack[0] = y; }
        if (op === 'rol') { let t = stack[0]; stack[0]=stack[1]; stack[1]=stack[2]; stack[2]=stack[3]; stack[3]=t; }
        if (op === '%') { stack[0] = y * (x/100); }
        if (op === 'sigma') { stats.n++; stats.sumX += x; stats.sumX2 += x*x; stack[0] = stats.n; }

        updateLCD();
    }

    function drop() {
        stack[1] = stack[2]; stack[2] = stack[3];
    }

    function pressTVM(key) {
        if (isTyping) { stack[0] = parseFloat(buffer); isTyping = false; }
        tvm[key] = stack[0];
        console.log("TVM Updated:", tvm);
        updateLCD();
    }

    function setMode(m) { mode = mode === m ? null : m; updateLCD(); }

    function resetCalc() {
        stack = [0,0,0,0]; tvm = {n:0,i:0,pv:0,pmt:0,fv:0}; 
        stats = {n:0,sumX:0,sumX2:0}; buffer = ""; isTyping = false; mode = null;
        updateLCD();
    }

    updateLCD();
</script>
</body>
</html>
