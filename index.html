<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>HP-12C Platinum â€” Master Final</title>

<style>
*{box-sizing:border-box;user-select:none}
body{
    background:#c0c0c0;display:flex;justify-content:center;align-items:center;
    min-height:100vh;margin:0;font-family:Segoe UI,Arial
}
.hp12c{
    background:#1a1a1a;width:740px;padding:40px 25px 80px;
    border-radius:12px;border:3px solid #000;
    box-shadow:0 50px 100px rgba(0,0,0,.7);position:relative
}
.faceplate{
    background:linear-gradient(180deg,#e0e0e0,#bbbbbb);
    border-radius:6px;padding:20px;border:1px solid #777
}
.lcd-container{background:#000;padding:5px;width:320px;margin-bottom:40px}
.lcd{
    background:#9ead94;height:70px;padding:10px;text-align:right;
    border:2px solid #333
}
#display{
    font:bold 38px "Courier New",monospace;color:#1a1d18
}
.indicators{font-size:11px;font-weight:bold;height:12px;text-align:left}
.logo{position:absolute;top:60px;right:50px;text-align:right}
.logo h1{margin:0;font-size:26px;font-style:italic;color:#222}
.keypad{
    display:grid;grid-template-columns:repeat(10,1fr);
    grid-template-rows:repeat(4,48px);gap:42px 12px
}
.btn-cell{position:relative}
.btn{
    width:100%;height:100%;border-radius:4px;font-weight:bold;
    font-size:13px;color:#fff;
    background:linear-gradient(180deg,#444,#111);
    border:none;border-bottom:4px solid #000;cursor:pointer
}
.btn:active{transform:translateY(2px);border-bottom:2px solid #000}
.btn-f{background:#d68a00!important;color:#000!important}
.btn-g{background:#0099cc!important}
.btn-enter{grid-column:6;grid-row:3/5;background:#555!important}
.lbl-f,.lbl-g{
    position:absolute;width:100%;text-align:center;
    font-size:10px;font-weight:bold
}
.lbl-f{top:-18px;color:#d68a00}
.lbl-g{bottom:-20px;color:#0099cc}
</style>
</head>

<body>
<div class="hp12c">
<div class="faceplate">

<div class="logo"><h1>hp 12c</h1><small>platinum</small></div>

<div class="lcd-container">
<div class="lcd">
<div class="indicators"><span id="ind"></span></div>
<div id="display">0,00</div>
</div>
</div>

<div class="keypad">
<button class="btn btn-enter" onclick="pressEnter()">ENTER</button>
</div>

</div>
</div>

<script>
/* =================== ESTADO =================== */
let stack = JSON.parse(localStorage.getItem("stack")) || [0,0,0,0];
let buffer="", isTyping=false, mode=null;
let beg = JSON.parse(localStorage.getItem("beg")) || false;

let tvm = JSON.parse(localStorage.getItem("tvm")) ||
{n:0,i:0,pv:0,pmt:0,fv:0};

let stats = JSON.parse(localStorage.getItem("stats")) ||
{n:0,sumX:0,sumY:0,sumXY:0,sumX2:0};

let cf = JSON.parse(localStorage.getItem("cf")) ||
{flows:[],i:0};

let memory = JSON.parse(localStorage.getItem("memory")) || {};

const displayEl=document.getElementById("display");
const indEl=document.getElementById("ind");

/* =================== UTIL =================== */
function save(){
    localStorage.setItem("stack",JSON.stringify(stack));
    localStorage.setItem("tvm",JSON.stringify(tvm));
    localStorage.setItem("stats",JSON.stringify(stats));
    localStorage.setItem("cf",JSON.stringify(cf));
    localStorage.setItem("memory",JSON.stringify(memory));
    localStorage.setItem("beg",JSON.stringify(beg));
}
function safe(n){return(!isFinite(n)||isNaN(n))?0:n}

/* =================== DISPLAY =================== */
function updateLCD(){
    displayEl.innerText=isTyping
        ?buffer.replace(".",",")
        :stack[0].toLocaleString("pt-BR",{minimumFractionDigits:2});
    indEl.innerText=(mode?mode.toUpperCase()+" ":"")+(beg?"BEG":"");
    save();
}

/* =================== PILHA =================== */
function drop(){stack[1]=stack[2];stack[2]=stack[3]}

/* =================== TECLAS =================== */
function pressNum(v){
    if(mode==="sto"){memory[v]=stack[0];mode=null;return updateLCD()}
    if(mode==="rcl"){stack[0]=memory[v]||0;mode=null;return updateLCD()}
    if(!isTyping){buffer=(v==="."?"0.":v);isTyping=true}
    else if(!(v==="."&&buffer.includes("."))) buffer+=v
    stack[0]=parseFloat(buffer)
    updateLCD()
}

function pressEnter(){
    if(isTyping){stack[0]=parseFloat(buffer);isTyping=false}
    stack[3]=stack[2];stack[2]=stack[1];stack[1]=stack[0]
    updateLCD()
}

/* =================== OPERADORES =================== */
function pressOp(op){
    if(isTyping){stack[0]=parseFloat(buffer);isTyping=false}
    let x=stack[0],y=stack[1]

    if(mode==="g"){
        if(op==="chs") beg=!beg
        if(op==="sigma") stats={n:0,sumX:0,sumY:0,sumXY:0,sumX2:0}
        if(op==="+")
            stack[0]=(stats.sumXY*stats.n-stats.sumX*stats.sumY)/
                     (stats.sumX2*stats.n-stats.sumX**2)
        mode=null;return updateLCD()
    }

    if(mode==="f"){
        if(op==="+")
            stack[0]=(stats.sumY*stats.sumX2-stats.sumX*stats.sumXY)/
                     (stats.sumX2*stats.n-stats.sumX**2)
        mode=null;return updateLCD()
    }

    switch(op){
        case "+":stack[0]=y+x;drop();break
        case "-":stack[0]=y-x;drop();break
        case "*":stack[0]=y*x;drop();break
        case "/":stack[0]=y/x;drop();break
        case "%":stack[0]=y*(x/100);drop();break
        case "chs":stack[0]=-x;buffer=stack[0]+"";break
        case "sigma":
            stats.n++;stats.sumX+=x;stats.sumY+=y
            stats.sumXY+=x*y;stats.sumX2+=x*x
            break
    }
    updateLCD()
}

/* =================== TVM =================== */
function pressTVM(k){
    if(isTyping){stack[0]=parseFloat(buffer);isTyping=false}
    if(stack[0]!==0){tvm[k]=stack[0];return updateLCD()}

    let {n,i,pv,pmt,fv}=tvm
    let r=i/100,f=Math.pow(1+r,n)
    let adj=beg?(1+r):1

    if(k==="fv") stack[0]=fv=pv*f+pmt*((f-1)/r)*adj
    if(k==="pv") stack[0]=pv=(fv-pmt*((f-1)/r)*adj)/f
    if(k==="pmt") stack[0]=pmt=(fv-pv*f)*r/((f-1)*adj)

    if(k==="i"){
        let rate=r||0.1
        for(let i=0;i<40;i++){
            let f0=pv*Math.pow(1+rate,n)+pmt*((Math.pow(1+rate,n)-1)/rate)*adj-fv
            let d0=n*pv*Math.pow(1+rate,n-1)
            rate-=f0/(d0||1e-8)
        }
        stack[0]=tvm.i=rate*100
        return updateLCD()
    }
    tvm={n,i,pv,pmt,fv}
    updateLCD()
}

/* =================== CASH FLOW =================== */
function calcNPV(){
    let r=cf.i/100,v=cf.flows[0]
    for(let i=1;i<cf.flows.length;i++)
        v+=cf.flows[i]/Math.pow(1+r,i)
    return v
}
function calcIRR(){
    let r=0.1
    for(let k=0;k<50;k++){
        let f=0,df=0
        for(let i=0;i<cf.flows.length;i++){
            let d=Math.pow(1+r,i)
            f+=cf.flows[i]/d
            df+=-i*cf.flows[i]/(d*(1+r))
        }
        let dr=f/(df||1e-8)
        r-=dr
        if(Math.abs(dr)<1e-7) break
    }
    return r*100
}

/* =================== MODOS =================== */
function setMode(m){mode=mode===m?null:m;updateLCD()}
function resetCalc(){
    stack=[0,0,0,0];buffer="";isTyping=false;mode=null;beg=false
    tvm={n:0,i:0,pv:0,pmt:0,fv:0}
    stats={n:0,sumX:0,sumY:0,sumXY:0,sumX2:0}
    cf={flows:[],i:0};memory={}
    updateLCD()
}

updateLCD()
</script>
</body>
</html>
